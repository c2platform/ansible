<?xml version='1.0' encoding='utf-8'?>
<!-- {{ ansible_managed }} -->
<!-- redirectPort="{{ confluence_proxy_port }}" -->
<Server port="8000" shutdown="SHUTDOWN" debug="0">
    <Service name="Tomcat-Standalone">
        <Connector port="{{ confluence_web_port }}"
                   connectionTimeout="20000"
                   redirectPort="{{ confluence_proxy_port }}"
                   maxThreads="48" minSpareThreads="10"
                   enableLookups="false"
                   acceptCount="10"
                   URIEncoding="UTF-8"
                   protocol="org.apache.coyote.http11.Http11NioProtocol"
                   useBodyEncodingForURI="true"
                   compression="on"
                   compressableMimeType="text/html,text/xml,text/plain,text/css,application/json,application/javascript,application/x-javascript"
                   secure="true"
                   scheme="https"
                   proxyName="{{ confluence_proxy_name }}"
                   proxyPort="{{ confluence_proxy_port }}"
                   />
{% if confluence_https['enable'] == True %}
        <Connector port="{{ confluence_https['port'] }}" maxHttpHeaderSize="8192"
                   maxThreads="150" minSpareThreads="25"
                   protocol="org.apache.coyote.http11.Http11NioProtocol"
                   enableLookups="false" disableUploadTimeout="true"
                   acceptCount="100" scheme="https" secure="true"
                   clientAuth="false" sslProtocols="TLSv1,TLSv1.1,TLSv1.2"
                   sslEnabledProtocols="TLSv1,TLSv1.1,TLSv1.2" SSLEnabled="true"
                   URIEncoding="UTF-8" keystorePass="changeit"
                   keystoreFile="/opt/confluence/confluence/home/.keystore"
                   keyAlias="tomcat"
                   proxyName="{{ confluence_proxy_name }}"
                   proxyPort="{{ confluence_proxy_port }}"
        />
{% endif %}
        <Engine name="Standalone" defaultHost="localhost">
            <Host name="localhost" appBase="webapps" unpackWARs="true" autoDeploy="false">
                <Context path="{{ confluence_web_context }}" docBase="../confluence" reloadable="false" useHttpOnly="true">
                   <Manager pathname="" />
                  <Valve className="org.apache.catalina.valves.StuckThreadDetectionValve" threshold="60" />                  
                </Context>
            </Host>
        </Engine>
    </Service>
</Server>
