#!/bin/bash
# {{ ansible_managed }}
# {{ vars[role + '_database_username'] }} Oracle Data Pump export script 

{% include './templates/_helpers.sh.j2' %}

{% include './templates/_env_oracle.sh.j2' %}

{% include './templates/oracle/_create_dir.sh.j2' %}

{% include './templates/_hooks_sh_confirm.sh.j2' %}

import_schema={{ vars[role+'_database_username']|upper }}
dump_schema=$(cat {{ role|role_schema_file(vars) }})

extra_opts="remap_schema=$dump_schema:$import_schema remap_tablespace=$dump_schema:$import_schema"

try impdp "{{ role|role_oracle_connect(vars) }}" {{ role|impdp_options(vars) }} $extra_opts schemas=$dump_schema

yell "Database imported to {{ vars[role + '_database_username'] }}"
