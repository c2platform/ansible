---
- name: systemd service
  template:
    src: bitbucket.service.j2
    dest: /etc/systemd/system/bitbucket.service
    owner: root
    group: root
    mode: 0755
  notify: restart bitbucket  
  when: "ansible_service_mgr == 'systemd'" 
  notify: bitbucket-systemctl-daemon-reload

- name: ensure service running and set to start on boot
  service: name=bitbucket state=started enabled=yes

#- name: Allow Sonar time to build on first start.
#  pause: seconds=180
#  when: install_symlink.changed
#  tags: ['skip_ansible_lint']

#- name: Make sure Sonar is responding on the configured port.
#  wait_for: port=9000 delay=3 timeout=300  